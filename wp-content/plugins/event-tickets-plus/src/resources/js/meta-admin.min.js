var tribe_event_tickets_plus=tribe_event_tickets_plus||{};tribe_event_tickets_plus.meta=tribe_event_tickets_plus.meta||{},tribe_event_tickets_plus.meta.admin=tribe_event_tickets_plus.meta.admin||{},tribe_event_tickets_plus.meta.admin.event=tribe_event_tickets_plus.meta.admin.event||{},function(e,t,i,n){const s=e.wp.i18n.__;n.selectors={attendeeForm:"tribe-tickets-attendee-info-form",fieldsetSaved:".tribe-tickets__admin-attendees-saved-fields",fieldsetSavedHasIac:".tribe-tickets__admin-attendees-saved-fields--has-iac",iacNotice:".tribe-tickets__admin-attendees-info-iac-notice",iacMockedFields:".tribe-tickets__admin-attendees-info-iac-fields",iacMockedFieldsLabelRequired:".tribe-tickets__admin-attendee-info-field-title-label--required",iacNoneCheckbox:"#ticket_iac_setting_none",iacAllowedCheckbox:"#ticket_iac_setting_allowed",iacRequiredCheckbox:"#ticket_iac_setting_required",hidden:".tribe-common-a11y-hidden"},n.init=function(){n.$tribe_tickets=i(t.getElementById("tribetickets")),n.$event_tickets=i(t.getElementById("event_tickets")),n.$fieldsetPage=i(".post-type-ticket-meta-fieldset"),n.$blockModal=i("#event-tickets-attendee-information"),n.$event_tickets.on("change","input.show_attendee_info",n.event.toggleLinkedForm).on("change",".save_attendee_fieldset",n.event.toggleLinkedForm),i(".meta-postbox .hndle, .meta-postbox .handlediv").off("click"),n.$tribe_tickets.on("change",".ticket-attendee-info-dropdown",n.event.selectSavedFieldset).on("change",".save_attendee_fieldset",n.event.toggleLinkedForm).on("click",".meta-postbox .hndle, .meta-postbox .handlediv",n.event.clickPostbox).on("click","a.add-attendee-field",n.event.addField).on("click","a.delete-attendee-field",n.event.removeField).on("edit-ticket.tribe",n.event.editTicket).on("saved-ticket.tribe",n.event.savedTicket).on("click","#rsvp_form_toggle",n.event.handleNewRsvp).on("click","#ticket_form_toggle",n.event.handleNewTicket).on("change",n.selectors.iacNoneCheckbox,n.event.handleIacCheckbox).on("change",n.selectors.iacAllowedCheckbox,n.event.handleIacCheckbox).on("change",n.selectors.iacRequiredCheckbox,n.event.handleIacCheckbox).on("additionalValidation.tribe",n.validateAttendeeLabels),n.$fieldsetPage.on("click","#publish",n.validateAttendeeLabels),n.$blockModal.on("click",'button[type="submit"]',n.validateAttendeeLabels),n.initTicketFields(),n.$event_tickets.trigger("event-tickets-plus-meta-initialized.tribe")},n.initTicketFields=function(){n.$event_tickets||(n.$event_tickets=i(t.getElementById("event_tickets"))),n.initCustomFieldSorting(),n.maybeHideSavedFieldsSelect(),n.maybeShowIacMockedFields(),n.$event_tickets.trigger("event-tickets-plus-ticket-meta-initialized.tribe",{ticket_id:n.$event_tickets.find("#ticket_id").val()})},n.initCustomFieldSorting=function(){i(t.getElementById("tribe-tickets-attendee-sortables")).sortable({containment:"parent",items:"> div",tolerance:"pointer",connectWith:"#tribe-tickets-attendee-sortables"})},n.validateAttendeeLabels=function(e,i){const d=t.getElementById(n.selectors.attendeeForm);if(!d)return!0;const c=[],a=d.querySelectorAll("input[name$='[label]']");for(let t=0;t<a.length;t++){if(c.indexOf(a[t].value)>-1){e.preventDefault(),alert(s("Duplicate labels are not allowed.\nPlease verify that you are not using the same label for different fields and try again.","event-tickets")),i=!1;break}c.push(a[t].value)}return i},n.toggleLinkedForm=function(e){let n=i();const s=e.data("tribe-toggle");s&&(n=i(t.getElementById(s))),e.is(":checked")?n.show():n.hide()},n.maybeHideSavedFieldsSelect=function(){i(".tribe-tickets__admin-attendee-info-field--active").length?i(n.selectors.fieldsetSaved).hide():i(n.selectors.fieldsetSaved).show()},n.maybeShowIacMockedFields=function(){const e=i(n.selectors.iacAllowedCheckbox).is(":checked"),t=i(n.selectors.iacRequiredCheckbox).is(":checked");e||t?n.showIacMockedFields():n.hideIacMockedFields()},n.hideIacMockedFields=function(){const e=i(n.selectors.iacAllowedCheckbox).closest("#ticket_form"),t=e.find(n.selectors.iacNotice),s=e.find(n.selectors.iacMockedFields),d=e.find(n.selectors.fieldsetSaved),c=n.selectors.hidden.className();t.addClass(c),s.addClass(c),d.removeClass(n.selectors.fieldsetSavedHasIac.className())},n.showIacMockedFields=function(){const e=i(n.selectors.iacAllowedCheckbox).closest("#ticket_form"),t=e.find(n.selectors.iacMockedFields),s=e.find(n.selectors.iacNotice),d=t.find(n.selectors.iacMockedFieldsLabelRequired),c=e.find(n.selectors.fieldsetSaved),a=i(n.selectors.iacRequiredCheckbox).is(":checked"),l=n.selectors.hidden.className();s.removeClass(l),t.removeClass(l),a?d.removeClass(l):d.addClass(l),c.addClass(n.selectors.fieldsetSavedHasIac.className())},n.event.handleIacCheckbox=function(e){e.preventDefault(),n.maybeShowIacMockedFields()},n.event.handleNewTicket=function(e){e.preventDefault(),n.maybeShowIacMockedFields()},n.event.handleNewRsvp=function(e){e.preventDefault(),n.hideIacMockedFields()},n.fetch_saved_fields=function(e){const t={action:"tribe-tickets-load-saved-fields",fieldset:e};return i.post(ajaxurl,t,"json")},n.inject_saved_fields=function(e){const s=n.fetch_saved_fields(e);s.done(function(s){s.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(s.data),n.maybeHideSavedFieldsSelect(),n.$event_tickets.trigger("event-tickets-plus-fieldset-loaded.tribe",{fieldset_id:e})):n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})}),s.fail(function(){n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})})},n.addField=function(e){const s={action:"tribe-tickets-info-render-field",type:e},d=i.post(ajaxurl,s,"json");d.done(function(s){s.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(s.data),n.maybeHideSavedFieldsSelect(),n.$event_tickets.trigger("event-tickets-plus-field-added.tribe",{type:e})):n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})}),d.fail(function(){n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})})},n.removeField=function(e){let t="";t="undefined"!==e[0].outerHTML?e[0].outerHTML:i("<div>").append(e.eq(0).clone()).html(),e.remove(),n.maybeHideSavedFieldsSelect(),n.$event_tickets.trigger("event-tickets-plus-field-removed.tribe",{field:t})},n.toggle_postbox=function(e){e.toggleClass("closed")},n.event.toggleLinkedForm=function(){n.toggleLinkedForm(i(this))},n.event.selectSavedFieldset=function(){const e=i(this).val();e&&0!==parseInt(e,10)&&n.inject_saved_fields(e)},n.event.addField=function(e){e.preventDefault(),n.addField(i(this).data("type"))},n.event.removeField=function(e){e.preventDefault(),n.removeField(i(this).closest(".meta-postbox"))},n.event.editTicket=function(){n.initTicketFields()},n.event.clickPostbox=function(){n.toggle_postbox(i(this).closest(".meta-postbox"))},n.event.savedTicket=function(e,n){if(void 0===n.fieldsets||!n.success)return;const s=i(t.getElementById("saved_ticket-attendee-info"));s.find('option:not([value="0"])').remove();for(let e=0;e<n.fieldsets.length;e++)s.append('<option value="'+n.fieldsets[e].ID+'" data-attendee-group="'+n.fieldsets[e].post_name.replace('"','\\"')+'">'+n.fieldsets[e].post_name+"</option>")},i(n.init)}(window,document,jQuery,tribe_event_tickets_plus.meta.admin);